(self.webpackChunk=self.webpackChunk||[]).push([[2165],{72165:(e,r,t)=>{t.r(r),t.d(r,{activate:()=>T});var i=t(32073),n=t(90572),o=t(59179),s=t(84714),a=t(58303),c=t(90023),d=t(28338),u=t(6183),p=t(93806),v=t(67177),l=t(12518),g=t(74623),S=t(2650),b=t(50373),h=t(810),f=t(82849),m=t(29246),C=t(64900),k=t(26373),y=t(66813),w=t(13391),A=t(11087),I=t(72847),P=t(39104),x=t(84178),B=t(2187),O=Object.defineProperty,V=Object.defineProperties,E=Object.getOwnPropertyDescriptors,F=Object.getOwnPropertySymbols,j=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable,U=(e,r,t)=>r in e?O(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t;var G,M,z;(M=G||(G={})).Id=g.Rn,M.create=e=>{const r=(0,y.j)(),t=e.decorationService.createDecorationFactory(M.Id),s=e.experimentationBridge.isAssigned(u.RK);r.debug("Checking if underlines should be kept",{shouldKeepUnderlines:s});const d=e.initNavigation(M.Id,s?S.r.Regular:S.r.SingleThread),p=h.Z.create({capiSessionStarted:e.capiSession.events.pipe((0,n.h)(I.hX.is("session_started")),(0,o.U)((e=>({sessionId:e.sessionUuid})))),capiConnectionEvents:e.capiSession.events.pipe((0,n.h)((0,P.Kg)(I.hX.is("connect"),I.hX.is("disconnect")))),agenticService:z.create({agentGenericService:e.agentGenericService,pushedContentService:e.pushedContentService}),isPanelOpen:d.isPanelOpen,featureFlags:{customVoice:e.experimentationBridge.isAssigned(u.zg),focusCard:e.experimentationBridge.isAssigned(u.Wd),aiChat:e.experimentationBridge.isAssigned(u.Q1)},editor:e.editor,trackingServiceProvider:e.trackingServiceProvider,decorationService:e.decorationService,fileUploadService:e.fileUploadService}),v=e=>{var r;return m.h.isWithRewrite(e)?null!=(r=e.surface.explanation)?r:e.surface.title:void 0},l=C.pS.create({agentId:M.Id,pushedContentService:e.pushedContentService,vbarFeedbackService:e.vbarFeedbackService,trackingServiceProvider:e.trackingServiceProvider,decorationsFactory:t,decorationService:e.decorationService,uphookHubClient:e.uphookHubClient,isActive:d.isPanelOpen,getDecorationFactory:f.p,experimentationBridge:e.experimentationBridge,userService:e.userService,itemsFilter:p.selectedMode.view((e=>r=>(0,k.B)(r)&&(0,c.zG)(e,a.Gg((e=>r.surface.sourceAction===e.sourceAction))))),agentMetadataSource:e=>(0,k.B)(e)?{sourceAction:e.surface.sourceAction}:void 0,vbarRenderOverrides:{getCardTitle:v,getVBarProps:(e,r)=>((e,r)=>V(e,E(r)))(((e,r)=>{for(var t in r||(r={}))j.call(r,t)&&U(e,t,r[t]);if(F)for(var t of F(r))R.call(r,t)&&U(e,t,r[t]);return e})({},e),{primaryText:v(r)}),getCardIcon:()=>({icon:A.y,size:"medium"})},trustedRewrite:c.jv}),g=w.h.create(!1),O=new i.w0;return O.add(e.capiSession.events.pipe(n.h(I.hX.is("session_started")),x.q(1),o.U((e=>e.allowedFeatures.includes("PARAPHRASER")))).subscribe(B.wW(g))),{agent:{id:M.Id,decorations:b.dX.Collection.create(M.Id,{pushedContent:l}),viewModel:p,dispose:()=>{p.dispose(),O.unsubscribe()}},isAvailable:g}},(z||(z={})).create=e=>{const{agentGenericService:r,pushedContentService:t}=e,i=(0,y.j)("AgenticService"),n=t.getCollection(k.B),o=()=>p.$.values(n.get()),s=e=>(0,k.f)(e,o()),a=n.view((()=>o()));return{getModes:()=>(0,c.zG)(r.request({commandId:"start",payload:"",agentId:G.Id}),v.Vn((e=>(i.error("Error requesting evaluation",e),e))),v.tS((e=>(i.debug("Received evaluation response",e),(0,c.zG)(v.Uo(g.OB.decode(e.payload)),v.Vn((e=>(i.error("Error decoding evaluation",e),e))),v.UI((e=>(i.debug("Decoded evaluation response",e),e)))))))),getRewrites:(e,t=!1)=>{const n=s(e);return!t&&n.length>0?(i.debug("Skipping request - VBars already exist for mode and force is false"),v.F2(void 0)):v.Y3((()=>r.requestWithStreaming({commandId:"triggerMode",payload:JSON.stringify({modeId:e.id}),agentId:G.Id})().then((e=>(0,c.zG)(e,l.pF((e=>{throw e}))))).then((e=>new Promise(((r,t)=>{e.subscribe((e=>{(0,c.zG)(e,l.g_((e=>{i.error("Error requesting pushed content:",e),t(e)}),(e=>{i.debug("Received pushed content response",e),"final"===e.kind&&r(void 0)})))}))}))))),l.KC)},clearVBars:()=>{i.debug("Clearing the Paraphraser VBars"),t.clear(k.B)},getCurrentVBars:o,getCurrentVBarsForMode:s,currentVBars:a}};var D=(e,r)=>(r=Symbol[e])?r:Symbol.for("Symbol."+e),q=e=>{throw TypeError(e)};const T=e=>{return r=void 0,t=[e],p=function*({bus:e,navigation:r,capiConnectionStatus:t,agentGenericService:p,pushedContentService:v,experimentation:l,document:S,fileUploadService:b,trackingServiceProvider:f}){var m=[];try{const y=((e,r,t)=>{var i;return null!=r?("object"!=typeof r&&"function"!=typeof r&&q("Object expected"),t&&(i=r[D("asyncDispose")]),void 0===i&&(i=r[D("dispose")]),"function"!=typeof i&&q("Object not disposable"),e.push([t,i,r])):t&&e.push([t]),r})(m,new DisposableStack),w=y.adopt(new i.w0,(e=>e.unsubscribe())),A=y.use(e.state.agentState.create(S.id,{kind:g.ZM.Kind.Initial})),I=y.use(e.state.capiSessionId.create(S.id,null)),x=y.use(e.state.wordCount.create(S.id,0)),B=y.adopt(h.Z.create({capiSessionStarted:t.pipe(n.h((e=>"connected"===e.kind)),o.U((e=>({sessionId:e.sessionId})))),capiConnectionEvents:t.view((e=>"connected"===e.kind?{kind:"connect"}:"disconnected"===e.kind?{kind:"disconnect"}:null)).pipe(n.h(P.C_)),agenticService:z.create({agentGenericService:p,pushedContentService:v}),isPanelOpen:r.isPanelOpen,featureFlags:{customVoice:l.isAssigned(u.zg),focusCard:l.isAssigned(u.Wd),aiChat:l.isAssigned(u.Q1)},editor:{changes:S.textChanges,getContents:()=>S.getText()},trackingServiceProvider:f,decorationService:{setFocusMode:c.Q1,focusModeDecorationType:s.of(a.YP),removeAgentDecorations:c.Q1},fileUploadService:b}),(e=>e.dispose()));return w.add(B.state.subscribe((e=>A.set(e)))),w.add(t.pipe(n.h((e=>"connected"===e.kind))).subscribe((e=>I.set(e.sessionId)))),w.add(B.context.textWordsCount.subscribe((e=>x.set(e)))),w.add(e.events.trackingEvent.view(S.id).subscribe((e=>B.context.tracking.trackEvent(e.event,e.detail)))),w.add(e.events.panelUIAction.view(S.id).subscribe((e=>{switch(e.kind){case"executeModeAction":B.executeMode(e.modeId);break;case"editCustomVoiceAction":B.editCustomVoice();break;case"saveCustomVoiceAction":B.saveCustomVoice(e.voiceName,e.content);break;case"removeCustomVoiceAction":B.removeCustomVoice(e.voiceName);break;case"reloadAgentAction":B.reloadAgent();break;case"goBackAction":B.goBack(e.previousState);break;default:(0,d.L0)(e)}}))),y.move()}catch(e){var C=e,k=!0}finally{((e,r,t)=>{var i="function"==typeof SuppressedError?SuppressedError:function(e,r,t,i){return(i=Error(t)).name="SuppressedError",i.error=e,i.suppressed=r,i},n=e=>r=t?new i(e,r,"An error was suppressed during disposal"):(t=!0,e),o=i=>{for(;i=e.pop();)try{var s=i[1]&&i[1].call(i[2]);if(i[0])return Promise.resolve(s).then(o,(e=>(n(e),o())))}catch(e){n(e)}if(t)throw r};o()})(m,C,k)}},new Promise(((e,i)=>{var n=e=>{try{s(p.next(e))}catch(e){i(e)}},o=e=>{try{s(p.throw(e))}catch(e){i(e)}},s=r=>r.done?e(r.value):Promise.resolve(r.value).then(n,o);s((p=p.apply(r,t)).next())}));var r,t,p}}}]);