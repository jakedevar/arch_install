(self.webpackChunk=self.webpackChunk||[]).push([[6347],{89449:(e,s,t)=>{t.d(s,{w:()=>g});var i=t(90023),n=t(21176),a=t(27368),r=t(90572),h=t(59179),c=t(31603),l=t(58303),_=t(67177),o=t(98846),d=t(68822),u=t(40594);class g{constructor(e){this._checkingService=e,this._handlers=[],this._log=u.Y.create("AgentsCapiClient"),this._checkingService.pipe(r.h(l.pC),h.U((e=>e.value.capiMessages)),c.J(),r.h((e=>(0,n.rE)(e)||(0,a.eJ)(e))),h.U((e=>e))).subscribe((e=>{this._handlers.forEach((s=>(this._log.debug("Handling CAPI Message",e),s(e),o._.Result.STOP_HANDLING)))}))}enqueueExternalCommand(e){this._log.debug("Enqueueing External Command",e);const s=(0,i.zG)(this._checkingService.get(),l.g_((()=>""),(e=>e.sessionUuid||""))),{action:t,...n}=e({sessionId:s,id:1,currentRevision:0,nextRevision:()=>1});return(0,i.zG)(this._checkingService.get(),_.Yo((()=>new d.YG("Checking service is not available"))),_.tS((e=>e.sendMessage(t,n,!0))))}registerExternalMessageHandler(e){this._handlers.includes(e)||this._handlers.push(e)}unregisterExternalMessageHandler(e){this._handlers=this._handlers.filter((s=>s!==e))}}},94320:(e,s,t)=>{t.r(s),t.d(s,{PromptEnhancerViewModelImpl:()=>E});var i=t(90023),n=t(32073),a=t(59179),r=t(67177),h=t(24666),c=t(13391),l=t(74822),_=t(44071),o=t(84766),d=t(90572),u=t(63532);class g{constructor(e,s=g.DEFAULT_POLLING_INTERVAL_MS){this._eventTypes=e,this._pollingIntervalMs=s,this._subs=new n.w0,this._currentUrl=c.h.create(self.location.href),this._eventsSubject=new l.x,this.events=this._eventsSubject.asObservable()}init(){this._setupEventListeners(),this._emitInitialPageState()}_setupEventListeners(){this._eventTypes.includes("url_change")&&this._setupUrlChangeListeners()}_setupUrlChangeListeners(){this._subs.add(_.R(self,"popstate").subscribe((()=>{this._handleUrlChange()}))),this._subs.add(_.R(self,"hashchange").subscribe((()=>{this._handleUrlChange()}))),this._setupUrlPolling()}_setupUrlPolling(){const e=o.F(this._pollingIntervalMs).pipe(d.h((()=>!document.hidden)),u.b((()=>this._handleUrlChange())));this._subs.add(e.subscribe())}_handleUrlChange(){const e=self.location.href;e!==this._currentUrl.get()&&(this._currentUrl.set(e),this._emitEvent({type:"url_change",timestamp:Date.now(),url:e}))}_emitInitialPageState(){this._emitEvent({type:"url_change",timestamp:Date.now(),url:self.location.href})}_emitEvent(e){this._eventsSubject.next(e)}checkForChanges(){this._eventTypes.includes("url_change")&&this._handleUrlChange()}dispose(){this._subs.unsubscribe(),this._eventsSubject.complete()}}g.DEFAULT_POLLING_INTERVAL_MS=1e3;class p{constructor(e){this._pageEventService=new g(["url_change"]),this.conversationStateChanges=this._pageEventService.events.pipe(a.U(e.detectState.bind(e)),h.x(((e,s)=>e===s)),a.U(e.getStateChangeData.bind(e)))}init(){this._pageEventService.init()}dispose(){this._pageEventService.dispose()}}var v=t(22425),b=t(89449);class S extends Error{constructor(e,s){super(e),this.nestedError=s}}class m{constructor(e){this._params=e;const s=new b.w(this._params.checkingService);this._agentGenericService=v.W.create(s)}sendRequest(e){return(0,i.zG)({commandId:e,payload:"",agentId:this._params.agentId},this._agentGenericService.request,r.Pd((s=>new S(`Failed to send ${e} request`,s)),i.Q1))}dispose(){this._agentGenericService.dispose()}}class E{constructor(e){this._params=e,this._subs=new n.w0,this._conversationStateService=new p(this._params.detector),this._agentService=new m({checkingService:this._params.checkingService,agentId:this._params.agentId})}init(){this._subs.add(this._conversationStateService.conversationStateChanges.pipe(a.U((e=>e.shouldDisableFeature?"disable":"enable"))).subscribe(this._execute.bind(this))),this._conversationStateService.init()}_execute(e){(0,i.zG)(this._agentService.sendRequest(e),r.Vn((s=>{this._params.telemetryService.error({message:s.message,error:s.nestedError,data:{agentId:this._params.agentId,commandId:e}})})))()}dispose(){this._subs.unsubscribe(),this._conversationStateService.dispose(),this._agentService.dispose()}}}}]);