(self.webpackChunk=self.webpackChunk||[]).push([[7156],{45128:(e,t,n)=>{n.d(t,{Z:()=>s});var o=n(28338);const i=class e{constructor(t,n=new URLSearchParams){this.base=t,this.params=n;const i=e._toString(t,n).length;(0,o.kG)(i<e.MAX_URL_LENGTH,"url exceeded length limit",String(i));const s=t.toLowerCase();(0,o.kG)(!1===s.startsWith("javascript:")&&!1===s.startsWith("data:"),"url is not allowed to use javascript: or data: protocols",t)}addParams(t){const n=Object.entries(t).reduce(((e,[t,n])=>(e.append(t,n),e)),(o=this.params,new URLSearchParams(o.toString())));var o;return new e(this.base,n)}toString(){return e._toString(this.base,this.params)}static _toString(e,t){const n=t.toString();return`${e}${n.length?`?${n}`:""}`}};i.MAX_URL_LENGTH=2083;let s=i},66878:(e,t,n)=>{n.d(t,{K:()=>a});var o=n(16537),i=n(96643),s=n(19064);function a(e){return(0,s.e)((function(t,n){var s,d=null,c=!1;d=t.subscribe((0,i.x)(n,void 0,void 0,(function(i){s=(0,o.Xf)(e(i,a(e)(t))),d?(d.unsubscribe(),d=null,s.subscribe(n)):c=!0}))),c&&(d.unsubscribe(),d=null,s.subscribe(n))}))}},78129:(e,t,n)=>{n.d(t,{G:()=>s});var o=n(19064),i=n(96643);function s(){return(0,o.e)((function(e,t){var n,o=!1;e.subscribe((0,i.x)(t,(function(e){var i=n;n=e,o&&t.next([i,e]),o=!0})))}))}},614:(e,t,n)=>{var o,i,s,a;n.d(t,{C:()=>o,P:()=>a}),i=o||(o={}),(s=i.Kind||(i.Kind={})).markAsAddedButtonClick="markAsAddedButtonClick",s.dismissButtonClick="dismissButtonClick",s.generateCitationButtonClick="generateCitationButtonClick",s.cardShow="cardShow",i.markAsAddedButtonClick=function(e){return{kind:"markAsAddedButtonClick",pushedContentItemId:e}},i.dismissButtonClick=function(e){return{kind:"dismissButtonClick",pushedContentItemId:e}},i.generateCitationButtonClick=function(e){return{kind:"generateCitationButtonClick",pushedContentItemId:e}},i.cardShow=function(e){return{kind:"cardShow",pushedContentItemId:e}},(e=>{var t;(t=e.Kind||(e.Kind={})).openUphook="openUphook",t.trackUphook="trackUphook",t.textTooShortViewMounted="textTooShortViewMounted",t.scoresLoadingViewMounted="scoresLoadingViewMounted",t.scoresLoadedViewMounted="scoresLoadedViewMounted",t.loadingLockedViewMounted="loadingLockedViewMounted",t.lockedViewMounted="lockedViewMounted",e.openUphook=function(e){return{kind:"openUphook",paywallUphook:e}},e.trackUphook=function(e,t){return{kind:"trackUphook",paywallUphook:e,event:t}},e.textTooShortViewMounted=function(){return{kind:"textTooShortViewMounted"}},e.scoresLoadingViewMounted=function(){return{kind:"scoresLoadingViewMounted"}},e.scoresLoadedViewMounted=function(){return{kind:"scoresLoadedViewMounted"}},e.loadingLockedViewMounted=function(){return{kind:"loadingLockedViewMounted"}},e.lockedViewMounted=function(){return{kind:"lockedViewMounted"}}})(a||(a={}))},37156:(e,t,n)=>{n.r(t),n.d(t,{activate:()=>Y});var o,i,s,a,d,c,r,u,l=n(8867),p=n(90572),k=n(84178),h=n(59179),w=n(20161),g=n(84714),S=n(50750),C=n(66878),b=n(36344),v=n(63532),m=n(954),f=n(32073),V=n(98189),P=n(78129),L=n(18827),M=n(84308),U=n(29416),A=n(13391),K=n(45128),I=n(28338),y=n(39104),B=n(64443),D=n(12838),E=n(614),x=n(90023),T=n(93806),G=n(67177),_=n(12518),O=n(69843),W=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),R=e=>{throw TypeError(e)},z=(e,t,n)=>t.has(e)||R("Cannot "+n),q=(e,t,n)=>(z(e,t,"read from private field"),n?n.call(e):t.get(e)),j=(e,t,n)=>t.has(e)?R("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),H=(e,t,n,o)=>(z(e,t,"write to private field"),o?o.call(e,n):t.set(e,n),n);function $(e){return new l.y((t=>(t.next(e),()=>e[Symbol.dispose]())))}class X{constructor(e){j(this,o),j(this,i),H(this,o,new DisposableStack),H(this,i,A.h.create(D.S.Locked.initial())),this.state=q(this,i).view(),q(this,o).adopt(A.h.combine(e.isPanelOpen,e.isDocumentActive,((e,t)=>e&&t)).pipe((0,p.h)(Boolean),(0,k.q)(1),(0,h.U)((()=>e.paywallConfig.get())),(0,w.w)((t=>(t?(0,g.of)(t):(0,S.D)(e.uphookHubClient.getUphookConfig("aiDetectorAgentPanelPaywall")).pipe((0,C.K)((t=>(e.logger.error("Error while fetching uphook config",t),b.E))),(0,p.h)(y.C_),(0,v.b)((t=>e.paywallConfig.set(t))))).pipe((0,h.U)((e=>D.S.Locked.uphookConfigResolved(e))),(0,m.O)((0,x.zG)(e.paywallConfig.get(),(e=>e?D.S.Locked.uphookConfigResolved(e):D.S.Locked.uphookConfigRequested()))))))).subscribe((e=>q(this,i).set(e))),(e=>e.unsubscribe()))}[Symbol.dispose](){q(this,o).dispose()}}o=new WeakMap,i=new WeakMap;class N{constructor(e){j(this,s),j(this,a),H(this,s,new DisposableStack),H(this,a,A.h.create(D.S.Unlocked.Enabled.initial())),this.state=q(this,a).view();const t=q(this,s).adopt(new f.w0,(e=>e.unsubscribe())),n=e.capiConnectionStatus.view((e=>"connected"===e.kind?e.sessionId:null)).pipe((0,V.n)((e=>null===e)));t.add(n.pipe((0,w.w)((t=>null===t?b.E:A.h.combine(e.isPanelOpen,e.isDocumentActive,((e,t)=>e&&t)).pipe((0,m.O)(null),(0,P.G)(),(0,w.w)((([t,n])=>n?function(e,t){return new l.y((n=>{(0,x.zG)(e.request({commandId:"start",payload:"",agentId:D.A}),G.Vn((e=>(t.error("Error while starting checks",e),e))))().then((e=>{_.nM(e)?n.error(e.left):n.complete()}))}))}(e.agentGenericService,e.logger):t?function(e,t){return new l.y((n=>{(0,x.zG)(e.request({commandId:"stop",payload:"",agentId:D.A}),G.Vn((e=>(t.error("Error while stopping checks",e),e))))().then((e=>{_.nM(e)?n.error(e.left):n.complete()}))}))}(e.agentGenericService,e.logger):b.E)),(0,C.K)((()=>b.E)))))).subscribe());const o=A.h.create(new Set);t.add(e.cardActions.subscribe((e=>{if(e.kind===E.C.Kind.markAsAddedButtonClick)return o.modify((t=>new Set(t).add(e.pushedContentItemId)))})));const i=A.h.create(!1);t.add(e.capiConnectionStatus.view((e=>"disconnected"===e.kind)).pipe((0,p.h)(Boolean),(0,w.w)((()=>e.capiConnectionStatus.pipe((0,p.h)((e=>"connected"===e.kind)),(0,k.q)(1),(0,L.g)(500),(0,h.U)((()=>!1)),(0,m.O)(!0))))).subscribe((e=>i.set(e))));const d=A.h.combine(e.capiCheckingState.asyncScores.view("ai_detector").view((e=>(null==e?void 0:e.outcomeScores.ai_detector_score)??null)),i,((e,t)=>t?null:e)),c=A.h.combine(d,e.capiCheckingState.asyncCheckingState.view("ai_detector").view((e=>"idle"!==e)),e.pushedContentService.getCollection(O.i).view((e=>T.$.values(e).filter(O.i))),((e,t,n)=>null!==e?{aiDetectorScorePercent:e,checkingInProgress:t,pushedContentItemIds:new Set(n.map((e=>e.contentId)))}:null));t.add((0,M.a)([e.capiConnectionStatus,c,c.pipe((0,p.h)(y.C_)),o]).pipe((0,h.U)((([e,t,n,o])=>[e,t??n,o]))).subscribe((([t,{aiDetectorScorePercent:n,checkingInProgress:o,pushedContentItemIds:i},s])=>{e.onContentStateChanged({remainingSuggestionCount:i.size,citedSuggestionCount:s.size,aiDetectorScorePercent:n}),q(this,a).set(D.S.Unlocked.Enabled.scoresReceived(s,i,n,o||"connected"!==t.kind))})))}[Symbol.dispose](){q(this,s).dispose()}}s=new WeakMap,a=new WeakMap;class Z{constructor(e){j(this,d),j(this,c),H(this,d,new DisposableStack),H(this,c,A.h.create(D.S.Unlocked.initial())),this.state=q(this,c).view();const t=$(new N(e)).pipe((0,w.w)((e=>e.state)),(0,h.U)((e=>({kind:D.S.Unlocked.Kind.Enabled,enabledState:e}))));q(this,d).adopt(e.wordCount.pipe((0,p.h)(y.C_),(0,k.q)(1),(0,h.U)(D.i),(0,w.w)((n=>n?t:e.wordCount.pipe((0,p.h)(D.i),(0,k.q)(1),(0,w.w)((()=>t)),(0,m.O)(D.S.Unlocked.textTooShort())))),(0,m.O)(null===e.wordCount.get()||(0,D.i)(e.wordCount.get())?D.S.Unlocked.initial():D.S.Unlocked.textTooShort())).subscribe((e=>q(this,c).set(e))),(e=>e.unsubscribe()))}[Symbol.dispose](){q(this,d).dispose()}}d=new WeakMap,c=new WeakMap;class F{constructor(e){j(this,r),j(this,u),H(this,r,new DisposableStack),H(this,u,A.h.create(D.S.initial())),this.state=q(this,u).view();const t=e.userService.user.view("free");q(this,r).adopt(t.pipe((0,w.w)((t=>t?$(new X(e)).pipe((0,w.w)((e=>e.state)),(0,h.U)((e=>({kind:D.S.Kind.Locked,lockedState:e})))):$(new Z(e)).pipe((0,w.w)((e=>e.state)),(0,h.U)((e=>({kind:D.S.Kind.Unlocked,unlockedState:e}))))))).subscribe((e=>q(this,u).set(e))),(e=>e.unsubscribe()))}[Symbol.dispose](){q(this,r).dispose()}}r=new WeakMap,u=new WeakMap;var J=(e=>(e.ComponentImpression="componentImpression",e.ComponentClicked="componentClicked",e))(J||{}),Q=(e=>(e.TextTooShortView="agentPanel/aiDetector/textTooShortView",e.ScoresLoadingView="agentPanel/aiDetector/scoresLoadingView",e.ScoresLoadedView="agentPanel/aiDetector/scoresLoadedView",e.LoadingLockedView="agentPanel/aiDetector/loadingLockedView",e.LockedView="agentPanel/aiDetector/lockedView",e.PanelContentReceived="agentPanel/aiDetector/panelContentReceived",e.MarkAsAddedButton="agentPanel/aiDetector/markAsAddedButton",e.DismissButton="agentPanel/aiDetector/dismissButton",e.GenerateCitationButton="agentPanel/aiDetector/generateCitationButton",e.Card="agentCard/aiDetector",e))(Q||{});const Y=async({bus:e,userService:t,document:n,pushedContentService:o,capiConnectionStatus:i,capiCheckingState:s,navigation:a,uphookHubClient:d,environment:c,agentGenericService:r,trackingServiceProvider:u})=>{var l=[];try{const S=((e,t,n)=>{var o;return null!=t?("object"!=typeof t&&"function"!=typeof t&&R("Object expected"),n&&(o=t[W("asyncDispose")]),void 0===o&&(o=t[W("dispose")]),"function"!=typeof o&&R("Object not disposable"),e.push([n,o,t])):n&&e.push([n]),t})(l,new DisposableStack),C=S.adopt(new f.w0,(e=>e.unsubscribe())),v=B.C8.Logging.getLogger("AiDetectorAgent"),m=S.use(e.state.panelState.create(n.id,D.S.initial())),V=S.use(e.state.paywallConfig.create(null)),P=u.getTrackingService(),L=A.h.create(null),x=S.use(new F({agentGenericService:r,uphookHubClient:d,userService:t,capiCheckingState:s,pushedContentService:o,capiConnectionStatus:i,isPanelOpen:a.isPanelOpen,isDocumentActive:n.isActive,paywallConfig:V,wordCount:s.textInfo.view((e=>(null==e?void 0:e.wordCount)??null)),cardActions:e.events.cardAction.view(n.id),onContentStateChanged:e=>L.set(e),logger:v}));S.adopt(x.state.subscribe((e=>m.set(e))),(e=>e.unsubscribe()));const T=()=>{var e;const t=i.get();return{agentId:D.A,capiSessionId:"connected"===t.kind?t.sessionId:void 0,documentWordCount:null==(e=s.textInfo.get())?void 0:e.wordCount}};return C.add((0,M.a)([L.pipe((0,U.b)(1e3)),a.isPanelOpen,n.isActive]).pipe((0,w.w)((([e,t,n])=>t&&n?(0,g.of)(e):b.E)),(0,p.h)(y.C_)).subscribe((e=>P.trackEvent(J.ComponentImpression,{componentId:Q.PanelContentReceived,detail:{...e,...T()}})))),C.add(e.events.panelAction.view(n.id).subscribe((e=>{const t=function(e,t,n){const o=t();switch(n.kind){case E.P.Kind.textTooShortViewMounted:case E.P.Kind.scoresLoadingViewMounted:case E.P.Kind.scoresLoadedViewMounted:case E.P.Kind.loadingLockedViewMounted:case E.P.Kind.lockedViewMounted:return{event:J.ComponentImpression,detail:{componentId:{[E.P.Kind.textTooShortViewMounted]:Q.TextTooShortView,[E.P.Kind.scoresLoadingViewMounted]:Q.ScoresLoadingView,[E.P.Kind.scoresLoadedViewMounted]:Q.ScoresLoadedView,[E.P.Kind.lockedViewMounted]:Q.LockedView,[E.P.Kind.loadingLockedViewMounted]:Q.LoadingLockedView}[n.kind],detail:n.kind===E.P.Kind.scoresLoadedViewMounted&&o.kind===D.S.Kind.Unlocked&&o.unlockedState.kind===D.S.Unlocked.Kind.Enabled&&o.unlockedState.enabledState.kind===D.S.Unlocked.Enabled.Kind.ScoresReceived?{...e(),remainingSuggestionCount:o.unlockedState.enabledState.pushedContentItemIds.size,citedSuggestionCount:o.unlockedState.enabledState.citedPushedContentItemsIds.size,aiDetectorScorePercent:o.unlockedState.enabledState.aiDetectorScorePercent}:e()}};case E.P.Kind.openUphook:case E.P.Kind.trackUphook:return null;default:(0,I.L0)(n)}}(T,(()=>m.get()),e);switch(t&&P.trackEvent(t.event,t.detail),e.kind){case E.P.Kind.openUphook:c.actions.openPopup(new K.Z(e.paywallUphook.content.ctaUrl));break;case E.P.Kind.trackUphook:d.trackUphookEvent(e.paywallUphook,e.event);break;case E.P.Kind.textTooShortViewMounted:case E.P.Kind.scoresLoadingViewMounted:case E.P.Kind.scoresLoadedViewMounted:case E.P.Kind.loadingLockedViewMounted:case E.P.Kind.lockedViewMounted:break;default:(0,I.L0)(e)}}))),C.add(e.events.cardAction.view(n.id).subscribe((e=>{const t=function(e,t){switch(t.kind){case E.C.Kind.markAsAddedButtonClick:case E.C.Kind.dismissButtonClick:case E.C.Kind.generateCitationButtonClick:return{event:J.ComponentClicked,detail:{componentId:{[E.C.Kind.markAsAddedButtonClick]:Q.MarkAsAddedButton,[E.C.Kind.dismissButtonClick]:Q.DismissButton,[E.C.Kind.generateCitationButtonClick]:Q.GenerateCitationButton}[t.kind],detail:e()}};case E.C.Kind.cardShow:return{event:J.ComponentImpression,detail:{componentId:Q.Card,detail:e()}};default:(0,I.L0)(t)}}(T,e);t&&P.trackEvent(t.event,t.detail)}))),S.move()}catch(e){var k=e,h=!0}finally{((e,t,n)=>{var o="function"==typeof SuppressedError?SuppressedError:function(e,t,n,o){return(o=Error(n)).name="SuppressedError",o.error=e,o.suppressed=t,o},i=e=>t=n?new o(e,t,"An error was suppressed during disposal"):(n=!0,e),s=o=>{for(;o=e.pop();)try{var a=o[1]&&o[1].call(o[2]);if(o[0])return Promise.resolve(a).then(s,(e=>(i(e),s())))}catch(e){i(e)}if(n)throw t};s()})(l,k,h)}}},69843:(e,t,n)=>{n.d(t,{i:()=>s});var o=n(29246),i=n(12838);const s=e=>o.z.isVBar(e)&&o.h.isWithComment(e)&&e.surface.sourceAgent===i.A}}]);