(self.webpackChunk=self.webpackChunk||[]).push([[2790],{45128:(e,t,n)=>{n.d(t,{Z:()=>a});var i=n(28338);const o=class e{constructor(t,n=new URLSearchParams){this.base=t,this.params=n;const o=e._toString(t,n).length;(0,i.kG)(o<e.MAX_URL_LENGTH,"url exceeded length limit",String(o));const a=t.toLowerCase();(0,i.kG)(!1===a.startsWith("javascript:")&&!1===a.startsWith("data:"),"url is not allowed to use javascript: or data: protocols",t)}addParams(t){const n=Object.entries(t).reduce(((e,[t,n])=>(e.append(t,n),e)),(i=this.params,new URLSearchParams(i.toString())));var i;return new e(this.base,n)}toString(){return e._toString(this.base,this.params)}static _toString(e,t){const n=t.toString();return`${e}${n.length?`?${n}`:""}`}};o.MAX_URL_LENGTH=2083;let a=o},66878:(e,t,n)=>{n.d(t,{K:()=>s});var i=n(16537),o=n(96643),a=n(19064);function s(e){return(0,a.e)((function(t,n){var a,d=null,c=!1;d=t.subscribe((0,o.x)(n,void 0,void 0,(function(o){a=(0,i.Xf)(e(o,s(e)(t))),d?(d.unsubscribe(),d=null,a.subscribe(n)):c=!0}))),c&&(d.unsubscribe(),d=null,a.subscribe(n))}))}},78129:(e,t,n)=>{n.d(t,{G:()=>a});var i=n(19064),o=n(96643);function a(){return(0,i.e)((function(e,t){var n,i=!1;e.subscribe((0,o.x)(t,(function(e){var o=n;n=e,i&&t.next([o,e]),i=!0})))}))}},99206:(e,t,n)=>{n.d(t,{i:()=>a});var i=n(29246),o=n(82550);const a=e=>{var t;return i.z.isVBar(e)&&i.h.isWithComment(e)&&e.surface.sourceAgent===o.P&&void 0!==(null==(t=e.surface.additionalElements)?void 0:t.plagiarism)}},12579:(e,t,n)=>{var i,o,a,s;n.d(t,{C:()=>i,P:()=>s}),o=i||(i={}),(a=o.Kind||(o.Kind={})).markAsAddedButtonClick="markAsAddedButtonClick",a.dismissButtonClick="dismissButtonClick",a.copyCitationButtonClick="copyCitationButtonClick",a.cardShow="cardShow",o.markAsAddedButtonClick=function(e){return{kind:"markAsAddedButtonClick",pushedContentItemId:e}},o.dismissButtonClick=function(e){return{kind:"dismissButtonClick",pushedContentItemId:e}},o.copyCitationButtonClick=function(e){return{kind:"copyCitationButtonClick",pushedContentItemId:e}},o.cardShow=function(e){return{kind:"cardShow",pushedContentItemId:e}},(e=>{var t;(t=e.Kind||(e.Kind={})).updateCitationStyle="updateCitationStyle",t.openUphook="openUphook",t.trackUphook="trackUphook",t.textTooShortViewMounted="textTooShortViewMounted",t.scoresLoadingViewMounted="scoresLoadingViewMounted",t.scoresLoadedViewMounted="scoresLoadedViewMounted",t.loadingLockedViewMounted="loadingLockedViewMounted",t.lockedViewMounted="lockedViewMounted",e.updateCitationStyle=function(e){return{kind:"updateCitationStyle",citationStyle:e}},e.openUphook=function(e){return{kind:"openUphook",paywallUphook:e}},e.trackUphook=function(e,t){return{kind:"trackUphook",paywallUphook:e,event:t}},e.textTooShortViewMounted=function(){return{kind:"textTooShortViewMounted"}},e.scoresLoadingViewMounted=function(){return{kind:"scoresLoadingViewMounted"}},e.scoresLoadedViewMounted=function(){return{kind:"scoresLoadedViewMounted"}},e.loadingLockedViewMounted=function(){return{kind:"loadingLockedViewMounted"}},e.lockedViewMounted=function(){return{kind:"lockedViewMounted"}}})(s||(s={}))},22790:(e,t,n)=>{n.r(t),n.d(t,{activate:()=>ee});var i,o,a,s,d,c,r,l,u=n(13391),p=n(8867),k=n(90572),h=n(84178),w=n(59179),g=n(20161),S=n(84714),C=n(50750),m=n(66878),b=n(36344),v=n(63532),f=n(954),y=n(32073),P=n(98189),V=n(78129),L=n(18827),M=n(84308),K=n(29416),U=n(45128),A=n(39104),I=n(28338),B=n(64443),E=n(62709),x=n(82550),T=n(12579),O=n(90023),G=n(93806),W=n(67177),D=n(12518),R=n(99206),_=(e,t)=>(t=Symbol[e])?t:Symbol.for("Symbol."+e),q=e=>{throw TypeError(e)},j=(e,t,n)=>t.has(e)||q("Cannot "+n),z=(e,t,n)=>(j(e,t,"read from private field"),n?n.call(e):t.get(e)),H=(e,t,n)=>t.has(e)?q("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),$=(e,t,n,i)=>(j(e,t,"write to private field"),i?i.call(e,n):t.set(e,n),n),X=(e=>(e.ComponentImpression="componentImpression",e.ComponentClicked="componentClicked",e))(X||{}),N=(e=>(e.TextTooShortView="agentPanel/plagiarism/textTooShortView",e.ScoresLoadingView="agentPanel/plagiarism/scoresLoadingView",e.ScoresLoadedView="agentPanel/plagiarism/scoresLoadedView",e.LoadingLockedView="agentPanel/plagiarism/loadingLockedView",e.LockedView="agentPanel/plagiarism/lockedView",e.PanelContentReceived="agentPanel/plagiarism/panelContentReceived",e.MarkAsAddedButton="agentPanel/plagiarism/markAsAddedButton",e.DismissButton="agentPanel/plagiarism/dismissButton",e.CopyCitationButton="agentPanel/plagiarism/copyCitationButton",e.CitationStyleSelect="agentPanel/plagiarism/citationStyleSelect",e.Card="agentCard/plagiarism",e))(N||{});function Z(e){return new p.y((t=>(t.next(e),()=>e[Symbol.dispose]())))}class F{constructor(e){H(this,i),H(this,o),$(this,i,new DisposableStack),$(this,o,u.h.create(x.S.Locked.initial())),this.state=z(this,o).view(),z(this,i).adopt(u.h.combine(e.isPanelOpen,e.isDocumentActive,((e,t)=>e&&t)).pipe((0,k.h)(Boolean),(0,h.q)(1),(0,w.U)((()=>e.paywallConfig.get())),(0,g.w)((t=>(t?(0,S.of)(t):(0,C.D)(e.uphookHubClient.getUphookConfig("plagiarismAgentPanelPaywall")).pipe((0,m.K)((t=>(e.logger.error("Error while fetching uphook config",t),b.E))),(0,k.h)(A.C_),(0,v.b)((t=>e.paywallConfig.set(t))))).pipe((0,w.U)((e=>x.S.Locked.uphookConfigResolved(e))),(0,f.O)((0,O.zG)(e.paywallConfig.get(),(e=>e?x.S.Locked.uphookConfigResolved(e):x.S.Locked.uphookConfigRequested()))))))).subscribe((e=>z(this,o).set(e))),(e=>e.unsubscribe()))}[Symbol.dispose](){z(this,i).dispose()}}i=new WeakMap,o=new WeakMap;class J{constructor(e){H(this,a),H(this,s),$(this,a,new DisposableStack),$(this,s,u.h.create(x.S.Unlocked.Enabled.initial())),this.state=z(this,s).view();const t=z(this,a).adopt(new y.w0,(e=>e.unsubscribe())),n=e.capiConnectionStatus.view((e=>"connected"===e.kind?e.sessionId:null)).pipe((0,P.n)((e=>null===e)));t.add(n.pipe((0,g.w)((t=>null===t?b.E:u.h.combine(e.isPanelOpen,e.isDocumentActive,((e,t)=>e&&t)).pipe((0,f.O)(null),(0,V.G)(),(0,g.w)((([t,n])=>n?function(e,t){return new p.y((n=>{(0,O.zG)(e.request({commandId:"start",payload:"",agentId:x.P}),W.Vn((e=>(t.error("Error while starting checks",e),e))))().then((e=>{D.nM(e)?n.error(e.left):n.complete()}))}))}(e.agentGenericService,e.logger):t?function(e,t){return new p.y((n=>{(0,O.zG)(e.request({commandId:"stop",payload:"",agentId:x.P}),W.Vn((e=>(t.error("Error while stopping checks",e),e))))().then((e=>{D.nM(e)?n.error(e.left):n.complete()}))}))}(e.agentGenericService,e.logger):b.E)),(0,m.K)((()=>b.E)))))).subscribe());const i=u.h.create(new Set);t.add(e.cardActions.subscribe((e=>{if(e.kind===T.C.Kind.markAsAddedButtonClick)return i.modify((t=>new Set(t).add(e.pushedContentItemId)))})));const o=u.h.create(!1);t.add(e.capiConnectionStatus.view((e=>"disconnected"===e.kind)).pipe((0,k.h)(Boolean),(0,g.w)((()=>e.capiConnectionStatus.pipe((0,k.h)((e=>"connected"===e.kind)),(0,h.q)(1),(0,L.g)(500),(0,w.U)((()=>!1)),(0,f.O)(!0))))).subscribe((e=>o.set(e))));const d=u.h.combine(e.capiCheckingState.asyncScores.view("plagiarism").view((e=>(null==e?void 0:e.outcomeScores.Originality)??null)).view((e=>null!==e?100*e:null)),o,((e,t)=>t?null:e)),c=u.h.combine(d,e.capiCheckingState.asyncCheckingState.view("plagiarism").view((e=>"idle"!==e)),e.pushedContentService.getCollection(R.i).view((e=>G.$.values(e).filter(R.i))),((e,t,n)=>null!==e?{originalityScorePercent:e,checkingInProgress:t,pushedContentItems:n}:null));t.add((0,M.a)([e.capiConnectionStatus,c,c.pipe((0,k.h)(A.C_)),i]).pipe((0,w.U)((([e,t,n,i])=>[e,t??n,i]))).subscribe((([t,{originalityScorePercent:n,checkingInProgress:i,pushedContentItems:o},a])=>{e.onContentStateChanged({remainingSuggestionCount:o.length,citedSuggestionCount:a.size,originalityScorePercent:n}),z(this,s).set(x.S.Unlocked.Enabled.scoresReceived(a,o,n,i||"connected"!==t.kind))})))}[Symbol.dispose](){z(this,a).dispose()}}a=new WeakMap,s=new WeakMap;class Q{constructor(e){H(this,d,new DisposableStack),H(this,c),$(this,c,u.h.create(x.S.Unlocked.initial(e.citationStyle))),this.state=z(this,c).view();const t=z(this,d).adopt(new y.w0,(e=>e.unsubscribe())),n=u.h.create(e.citationStyle);t.add(e.panelActions.subscribe((e=>{if(e.kind===T.P.Kind.updateCitationStyle)return n.set(e.citationStyle)})));const i=Z(new J(e)).pipe((0,g.w)((e=>e.state)),(0,w.U)((e=>({kind:x.S.Unlocked.Kind.Enabled,enabledState:e}))));z(this,d).adopt((0,M.a)([e.wordCount.pipe((0,k.h)(A.C_),(0,h.q)(1),(0,w.U)(x.i),(0,g.w)((t=>t?i:e.wordCount.pipe((0,k.h)(x.i),(0,h.q)(1),(0,g.w)((()=>i)),(0,f.O)(x.S.Unlocked.textTooShort(n.get()))))),(0,f.O)(null===e.wordCount.get()||(0,x.i)(e.wordCount.get())?x.S.Unlocked.initial(n.get()):x.S.Unlocked.textTooShort(n.get()))),n]).pipe((0,w.U)((([e,t])=>({...e,citationStyle:t})))).subscribe((e=>z(this,c).set(e))),(e=>e.unsubscribe()))}[Symbol.dispose](){z(this,d).dispose()}}d=new WeakMap,c=new WeakMap;class Y{constructor(e){H(this,r),H(this,l),$(this,r,new DisposableStack),$(this,l,u.h.create(x.S.initial())),this.state=z(this,l).view();const t=e.userService.user.view("free");z(this,r).adopt(t.pipe((0,g.w)((t=>t?Z(new F(e)).pipe((0,g.w)((e=>e.state)),(0,w.U)((e=>({kind:x.S.Kind.Locked,lockedState:e})))):Z(new Q(e)).pipe((0,g.w)((e=>e.state)),(0,w.U)((e=>({kind:x.S.Kind.Unlocked,unlockedState:e}))))))).subscribe((e=>z(this,l).set(e))),(e=>e.unsubscribe()))}[Symbol.dispose](){z(this,r).dispose()}}r=new WeakMap,l=new WeakMap;const ee=async({bus:e,userService:t,document:n,pushedContentService:i,capiConnectionStatus:o,capiCheckingState:a,navigation:s,uphookHubClient:d,environment:c,agentGenericService:r,trackingServiceProvider:l})=>{var p=[];try{const C=((e,t,n)=>{var i;return null!=t?("object"!=typeof t&&"function"!=typeof t&&q("Object expected"),n&&(i=t[_("asyncDispose")]),void 0===i&&(i=t[_("dispose")]),"function"!=typeof i&&q("Object not disposable"),e.push([n,i,t])):n&&e.push([n]),t})(p,new DisposableStack),m=C.adopt(new y.w0,(e=>e.unsubscribe())),v=B.C8.Logging.getLogger("PlagiarismCheckerAgent"),f=C.use(e.state.panelState.create(n.id,x.S.initial())),P=C.use(e.state.paywallConfig.create(null)),V=l.getTrackingService(),L=u.h.create(null),O=C.use(new Y({agentGenericService:r,uphookHubClient:d,userService:t,capiCheckingState:a,pushedContentService:i,capiConnectionStatus:o,isPanelOpen:s.isPanelOpen,isDocumentActive:n.isActive,paywallConfig:P,wordCount:a.textInfo.view((e=>(null==e?void 0:e.wordCount)??null)),cardActions:e.events.cardAction.view(n.id),panelActions:e.events.panelAction.view(n.id),citationStyle:E.aO.APA,onContentStateChanged:e=>L.set(e),logger:v}));C.adopt(O.state.subscribe((e=>f.set(e))),(e=>e.unsubscribe()));const G=()=>{var e;const t=o.get();return{agentId:x.P,capiSessionId:"connected"===t.kind?t.sessionId:void 0,documentWordCount:null==(e=a.textInfo.get())?void 0:e.wordCount}};return m.add((0,M.a)([L.pipe((0,K.b)(1e3)),s.isPanelOpen,n.isActive]).pipe((0,g.w)((([e,t,n])=>t&&n?(0,S.of)(e):b.E)),(0,k.h)(A.C_)).subscribe((e=>V.trackEvent(X.ComponentImpression,{componentId:N.PanelContentReceived,detail:{...e,...G()}})))),C.adopt(e.events.panelAction.view(n.id).subscribe((e=>{const t=function(e,t,n){const i=t();switch(n.kind){case T.P.Kind.textTooShortViewMounted:case T.P.Kind.scoresLoadingViewMounted:case T.P.Kind.scoresLoadedViewMounted:case T.P.Kind.loadingLockedViewMounted:case T.P.Kind.lockedViewMounted:return{event:X.ComponentImpression,detail:{componentId:{[T.P.Kind.textTooShortViewMounted]:N.TextTooShortView,[T.P.Kind.scoresLoadingViewMounted]:N.ScoresLoadingView,[T.P.Kind.scoresLoadedViewMounted]:N.ScoresLoadedView,[T.P.Kind.lockedViewMounted]:N.LockedView,[T.P.Kind.loadingLockedViewMounted]:N.LoadingLockedView}[n.kind],detail:n.kind===T.P.Kind.scoresLoadedViewMounted&&i.kind===x.S.Kind.Unlocked&&i.unlockedState.kind===x.S.Unlocked.Kind.Enabled&&i.unlockedState.enabledState.kind===x.S.Unlocked.Enabled.Kind.ScoresReceived?{...e(),remainingSuggestionCount:i.unlockedState.enabledState.pushedContentItems.length,citedSuggestionCount:i.unlockedState.enabledState.citedPushedContentItemsIds.size,originalityScorePercent:i.unlockedState.enabledState.originalityScorePercent}:e()}};case T.P.Kind.updateCitationStyle:return{event:X.ComponentClicked,detail:{componentId:N.CitationStyleSelect,detail:{...e(),citationStyle:n.citationStyle}}};case T.P.Kind.openUphook:case T.P.Kind.trackUphook:return null;default:(0,I.L0)(n)}}(G,(()=>f.get()),e);switch(t&&V.trackEvent(t.event,t.detail),e.kind){case T.P.Kind.openUphook:c.actions.openPopup(new U.Z(e.paywallUphook.content.ctaUrl));break;case T.P.Kind.trackUphook:d.trackUphookEvent(e.paywallUphook,e.event);break;case T.P.Kind.textTooShortViewMounted:case T.P.Kind.scoresLoadingViewMounted:case T.P.Kind.scoresLoadedViewMounted:case T.P.Kind.loadingLockedViewMounted:case T.P.Kind.lockedViewMounted:case T.P.Kind.updateCitationStyle:break;default:(0,I.L0)(e)}})),(e=>e.unsubscribe())),C.adopt(e.events.cardAction.view(n.id).subscribe((e=>{const t=function(e,t){switch(t.kind){case T.C.Kind.markAsAddedButtonClick:case T.C.Kind.dismissButtonClick:case T.C.Kind.copyCitationButtonClick:return{event:X.ComponentClicked,detail:{componentId:{[T.C.Kind.markAsAddedButtonClick]:N.MarkAsAddedButton,[T.C.Kind.dismissButtonClick]:N.DismissButton,[T.C.Kind.copyCitationButtonClick]:N.CopyCitationButton}[t.kind],detail:e()}};case T.C.Kind.cardShow:return{event:X.ComponentImpression,detail:{componentId:N.Card,detail:e()}};default:(0,I.L0)(t)}}(G,e);t&&V.trackEvent(t.event,t.detail)})),(e=>e.unsubscribe())),C.move()}catch(e){var h=e,w=!0}finally{((e,t,n)=>{var i="function"==typeof SuppressedError?SuppressedError:function(e,t,n,i){return(i=Error(n)).name="SuppressedError",i.error=e,i.suppressed=t,i},o=e=>t=n?new i(e,t,"An error was suppressed during disposal"):(n=!0,e),a=i=>{for(;i=e.pop();)try{var s=i[1]&&i[1].call(i[2]);if(i[0])return Promise.resolve(s).then(a,(e=>(o(e),a())))}catch(e){o(e)}if(n)throw t};a()})(p,h,w)}}}}]);